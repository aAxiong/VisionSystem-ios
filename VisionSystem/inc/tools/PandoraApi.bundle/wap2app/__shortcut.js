/*!
 * =====================================================
 * stream shortcut v0.1.6
 * =====================================================
 */
var shortcut_util=function(a,b){var c=/complete|loaded|interactive/,d=/^#([\w-]+)$/,e=/^\.([\w-]+)$/,f=/^[\w-]+$/,g=/translate(?:3d)?\((.+?)\)/,h=/matrix(3d)?\((.+?)\)/,i=function(b,c){if(c=c||a,!b)return j();if("object"==typeof b)return i.isArrayLike(b)?j(i.slice.call(b),null):j([b],null);if("function"==typeof b)return i.ready(b);if("string"==typeof b)try{if(b=b.trim(),d.test(b)){var e=a.getElementById(RegExp.$1);return j(e?[e]:[])}return j(i.qsa(b,c),b)}catch(a){}return j()},j=function(a,b){return a=a||[],Object.setPrototypeOf(a,i.fn),a.selector=b||"",a};i.data={},i.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof h&&(l=h,h=arguments[j]||{},j++),"object"==typeof h||i.isFunction(h)||(h={}),j===k&&(h=this,j--);j<k;j++)if(null!=(a=arguments[j]))for(c in a)d=h[c],e=a[c],h!==e&&(l&&e&&(i.isPlainObject(e)||(f=i.isArray(e)))?(f?(f=!1,g=d&&i.isArray(d)?d:[]):g=d&&i.isPlainObject(d)?d:{},h[c]=i.extend(l,g,e)):e!==b&&(h[c]=e));return h},i.noop=function(){},i.slice=[].slice,i.filter=[].filter,i.type=function(a){return null==a?String(a):k[{}.toString.call(a)]||"object"},i.isArray=Array.isArray||function(a){return a instanceof Array},i.isArrayLike=function(a){var b=!!a&&"length"in a&&a.length,c=i.type(a);return"function"!==c&&!i.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)},i.isWindow=function(a){return null!=a&&a===a.window},i.isObject=function(a){return"object"===i.type(a)},i.isPlainObject=function(a){return i.isObject(a)&&!i.isWindow(a)&&Object.getPrototypeOf(a)===Object.prototype},i.isEmptyObject=function(a){for(var c in a)if(c!==b)return!1;return!0},i.isFunction=function(a){return"function"===i.type(a)},i.qsa=function(b,c){return c=c||a,i.slice.call(e.test(b)?c.getElementsByClassName(RegExp.$1):f.test(b)?c.getElementsByTagName(b):c.querySelectorAll(b))},i.ready=function(b){return c.test(a.readyState)?b(i):a.addEventListener("DOMContentLoaded",function(){b(i)},!1),this},i.buffer=function(a,b,c){function d(){e&&(e.cancel(),e=0),f=i.now(),a.apply(c||this,arguments),g=i.now()}var e,f=0,g=0,b=b||150;return i.extend(function(){!f||g>=f&&i.now()-g>b||g<f&&i.now()-f>8*b?d():(e&&e.cancel(),e=i.later(d,b,null,arguments))},{stop:function(){e&&(e.cancel(),e=0)}})},i.each=function(a,b,c){if(!a)return this;if("number"==typeof a.length)[].every.call(a,function(a,c){return b.call(a,c,a)!==!1});else for(var d in a)if(c){if(a.hasOwnProperty(d)&&b.call(a[d],d,a[d])===!1)return a}else if(b.call(a[d],d,a[d])===!1)return a;return this},i.getStyles=function(a,b){var c=a.ownerDocument.defaultView.getComputedStyle(a,null);return b?c.getPropertyValue(b)||c[b]:c},i.parseTranslate=function(a,b){var c=a.match(g||"");return c&&c[1]||(c=["","0,0,0"]),c=c[1].split(","),c={x:parseFloat(c[0]),y:parseFloat(c[1]),z:parseFloat(c[2])},b&&c.hasOwnProperty(b)?c[b]:c},i.parseTranslateMatrix=function(a,b){var c=a.match(h),d=c&&c[1];c?(c=c[2].split(","),"3d"===d?c=c.slice(12,15):(c.push(0),c=c.slice(4,7))):c=[0,0,0];var e={x:parseFloat(c[0]),y:parseFloat(c[1]),z:parseFloat(c[2])};return b&&e.hasOwnProperty(b)?e[b]:e},i.later=function(a,b,c,d){b=b||0;var e,f,g=a,h=d;return"string"==typeof a&&(g=c[a]),e=function(){g.apply(c,i.isArray(h)?h:[h])},f=setTimeout(e,b),{id:f,cancel:function(){clearTimeout(f)}}},i.now=Date.now||function(){return+new Date};var k={};return i.each(["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],function(a,b){k["[object "+b+"]"]=b.toLowerCase()}),window.JSON&&(i.parseJSON=JSON.parse),i.plusReady=function(b){return window.plus?setTimeout(function(){b()},0):a.addEventListener("plusready",function(){b()},!1),this},i}(document);!function(a,b,c){var d="application/json",e="text/html",f=/^(?:text|application)\/javascript/i,g=/^(?:text|application)\/xml/i,h=/^\s*$/;a.ajaxSettings={type:"GET",beforeSend:a.noop,success:a.noop,error:a.noop,complete:a.noop,context:null,xhr:function(a){return new b.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:d,xml:"application/xml, text/xml",html:e,text:"text/plain"},timeout:0,processData:!0,cache:!0};var i=function(a,b){var c=b.context;if(b.beforeSend.call(c,a,b)===!1)return!1},j=function(a,b,c){c.success.call(c.context,a,"success",b),l("success",b,c)},k=function(a,b,c,d){d.error.call(d.context,c,b,a),l(b,c,d)},l=function(a,b,c){c.complete.call(c.context,b,a)},m=function(b,c,d,e){var f,g=a.isArray(c),h=a.isPlainObject(c);a.each(c,function(c,i){f=a.type(i),e&&(c=d?e:e+"["+(h||"object"===f||"array"===f?c:"")+"]"),!e&&g?b.add(i.name,i.value):"array"===f||!d&&"object"===f?m(b,i,d,c):b.add(c,i)})},n=function(b){if(b.processData&&b.data&&"string"!=typeof b.data){var e=b.contentType;!e&&b.headers&&(e=b.headers["Content-Type"]),e&&~e.indexOf(d)?b.data=JSON.stringify(b.data):b.data=a.param(b.data,b.traditional)}!b.data||b.type&&"GET"!==b.type.toUpperCase()||(b.url=o(b.url,b.data),b.data=c)},o=function(a,b){return""===b?a:(a+"&"+b).replace(/[&?]{1,2}/,"?")},p=function(a){return a&&(a=a.split(";",2)[0]),a&&(a===e?"html":a===d?"json":f.test(a)?"script":g.test(a)&&"xml")||"text"},q=function(b,d,e,f){return a.isFunction(d)&&(f=e,e=d,d=c),a.isFunction(e)||(f=e,e=c),{url:b,data:d,success:e,dataType:f}};a.ajax=function(d,e){"object"==typeof d&&(e=d,d=c);var f=e||{};f.url=d||f.url;for(var g in a.ajaxSettings)f[g]===c&&(f[g]=a.ajaxSettings[g]);n(f);var l=f.dataType;f.cache!==!1&&(e&&e.cache===!0||"script"!==l)||(f.url=o(f.url,"_="+a.now()));var m,q=f.accepts[l&&l.toLowerCase()],r={},s=function(a,b){r[a.toLowerCase()]=[a,b]},t=/^([\w-]+:)\/\//.test(f.url)?RegExp.$1:b.location.protocol,u=f.xhr(f),v=u.setRequestHeader;if(s("X-Requested-With","XMLHttpRequest"),s("Accept",q||"*/*"),(q=f.mimeType||q)&&(q.indexOf(",")>-1&&(q=q.split(",",2)[0]),u.overrideMimeType&&u.overrideMimeType(q)),(f.contentType||f.contentType!==!1&&f.data&&"GET"!==f.type.toUpperCase())&&s("Content-Type",f.contentType||"application/x-www-form-urlencoded"),f.headers)for(var w in f.headers)s(w,f.headers[w]);if(u.setRequestHeader=s,u.onreadystatechange=function(){if(4===u.readyState){u.onreadystatechange=a.noop,clearTimeout(m);var b,c=!1,d="file:"===t;if(u.status>=200&&u.status<300||304===u.status||0===u.status&&d&&u.responseText){l=l||p(f.mimeType||u.getResponseHeader("content-type")),b=u.responseText;try{"script"===l?(0,eval)(b):"xml"===l?b=u.responseXML:"json"===l&&(b=h.test(b)?null:a.parseJSON(b))}catch(a){c=a}c?k(c,"parsererror",u,f):j(b,u,f)}else{var e=u.status?"error":"abort",g=u.statusText||null;d&&(e="error",g="404"),k(g,e,u,f)}}},i(u,f)===!1)return u.abort(),k(null,"abort",u,f),u;if(f.xhrFields)for(var w in f.xhrFields)u[w]=f.xhrFields[w];var x=!("async"in f)||f.async;u.open(f.type.toUpperCase(),f.url,x,f.username,f.password);for(var w in r)r.hasOwnProperty(w)&&v.apply(u,r[w]);return f.timeout>0&&(m=setTimeout(function(){u.onreadystatechange=a.noop,u.abort(),k(null,"timeout",u,f)},f.timeout)),u.send(f.data?f.data:null),u},a.param=function(a,b){var c=[];return c.add=function(a,b){this.push(encodeURIComponent(a)+"="+encodeURIComponent(b))},m(c,a,b),c.join("&").replace(/%20/g,"+")},a.get=function(){return a.ajax(q.apply(null,arguments))},a.post=function(){var b=q.apply(null,arguments);return b.type="POST",a.ajax(b)},a.getJSON=function(){var b=q.apply(null,arguments);return b.dataType="json",a.ajax(b)}}(shortcut_util,window),function(a){var b=document.createElement("a");b.href=window.location.href,a.plusReady(function(){a.ajaxSettings=a.extend(a.ajaxSettings,{xhr:function(a){if(a.crossDomain)return new plus.net.XMLHttpRequest;if("file:"!==b.protocol){var c=document.createElement("a");if(c.href=a.url,c.href=c.href,a.crossDomain=b.protocol+"//"+b.host!=c.protocol+"//"+c.host,a.crossDomain)return new plus.net.XMLHttpRequest}return new window.XMLHttpRequest}})})}(shortcut_util),function(){function a(a){var b=plus.android.runtimeMainActivity(),c=b.getPackageManager(),d=plus.android.importClass(c);try{if(c.getPackageInfo(a,d.GET_ACTIVITIES))return!0}catch(a){}return!1}function b(){Da?(Va='"'+Da+'"'+Va,Ua+=Da+"流应用版",Wa+=Da+"流应用版"):setTimeout(function(){console.log("delay init_name"),b()},100)}function c(a){style_config=shortcut_util.extend({},a.popover);var b=document.createElement("div");b.setAttribute("style","position: fixed;top:0;bottom:0;left: 0;right: 0;background-color: rgba(0,0,0,.3);z-index: 2147483641;"),b.id="__shortcut_guide_popover",b.style.display="none";var c=document.createElement("iframe");c.onload=function(){var b={action:"init",config:a};_a.postMessage(b)},c.id="__shortcut_ifm",c.src=ja,c.style.border=0,c.style.width="100%",c.style.height="100%",b.appendChild(c),document.body.appendChild(b)}function d(){if(console.log("startCreateShortCut begin"),"myapp"!==ra&&ra!==sa){if(oa&&["HUAWEI","Xiaomi","Meizu"].indexOf(Ha)==-1)return void k("已创建桌面图标，如没有请检查设置");shortcut_util.getJSON(da,{launcher:Ea},function(a){a?0==a.ret?(console.log(Ea+" is 3rd laucher"),h(a)):~["Xiaomi","HUAWEI","Meizu","QiKU","360","vivo","smartisan"].indexOf(Ha)?i():shortcut_util.getJSON(ea,{vendor:Ha,launcher:Ea,model:Ia,os:plus.os.version},function(a){a?(xa=a,console.log("快捷方式相关权限检测接口，返回数据："+JSON.stringify(xa)),i()):plus.navigator.createShortcut({force:!1})}):plus.navigator.createShortcut({force:!1})})}}function f(a){console.log("ajax request："+JSON.stringify(a)),shortcut_util.post(fa,shortcut_util.extend($a,a),function(a){console.log("ajax response:"+JSON.stringify(a))},"json")}function g(a){console.log("report user log:"+a);var b=[1,4].indexOf(a)>-1?800:0,c={appid:plus.runtime.appid,av:plus.runtime.version,imei:Ja,vendor:Ha,launcher:Ea,model:Ia,os:plus.os.version,lv:"",vb:plus.runtime.innerVersion,net:plus.networkinfo.getCurrentType(),sf:ra,type:a};setTimeout(function(){shortcut_util.post(ga,c,function(){},"json")},b)}function h(a){if(f({op:-2,fp:-2}),1==a.permission.create)g(41),j(a.permission.unique);else if(wa=!0,g(42),ma)g(85),f({sg:1,gm:Na}),plus.storage.setItem("__LAUNCHER_NAME",a.permission.name),_a.postMessage({action:"guide_change_launcher",name:a.permission.name}),Ca="guide_change_launcher",J(Y);else{if("switchLightApp"==plus.runtime.appid)return void(ka=!0);oa||(ka=!0)}}function i(){var a=G();"HUAWEI"==Ha&&Fa<6||"Meizu"==Ha&&Fa<5.1||"Xiaomi"==Ha&&Fa<4.1?(g(11),f({op:4,fp:4}),k()):"HUAWEI"==Ha||"Meizu"==Ha?z(a):l()}function j(a){var b='"'+Da+'"已安装到桌面。如没有请检查桌面是否有空位或重启手机';1!=a&&(b+="，如有重复图标请手动删除"),I(b,"icon","","",""),k(b)}function k(a){a?plus.navigator.createShortcut({force:!1,toast:""}):plus.navigator.createShortcut({force:!1}),g(2),ka=!0,setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(b){console.log("has shortcut result："+b.result),b.result==Pa?(g(3),a=a?a:'"'+Da+'"已安装到桌面',I(a,"icon","","",""),f({sg:0,sr:1,sc:b.result}),plus.storage.setItem("__HAS_SHORTCUT_"+qa,"TRUE")):(Ta=!0,f({sg:0,sc:b.result}))})},500)}function l(){console.log("createShortcut begin");var a="";"HUAWEI"!=Ha&&"Meizu"!=Ha&&(a=plus.navigator.checkPermission("SHORTCUT"),f({op:a}),console.log(Ha+"引导前的快捷方式权限:"+a)),"Xiaomi"==Ha?m(a):"Meizu"==Ha||"HUAWEI"==Ha?n():~["QiKU","360"].indexOf(Ha)?t():"vivo"==Ha?s():"smartisan"==Ha?(g(2),plus.navigator.createShortcut({force:!1,toast:""}),"com.android.launcher3"==Ea?(I("应用已安装到桌面。如没有请尝试重启手机。请勿删除桌面图标，否则应用无法启动","icon","","",""),f({sr:"1"})):(J(Y),_a.postMessage({action:"show_popover",selector:".chuizi"}))):o()}function m(a){if("authorized"==a||"unsupported"==a)g("authorized"==a?13:10),g(2),plus.navigator.createShortcut({force:!1,toast:""}),I('"'+Da+'"已安装到桌面',"icon","","",""),ka=!0,Ta=!0;else if("undetermined"==a){_a.postMessage({action:"show_popover",selector:".xiaomi"}),g(14),f({sg:1,gm:La}),g(2),plus.navigator.createShortcut({force:!1,toast:""});var b=(new Date).getTime(),c=setInterval(function(){var a=plus.navigator.checkPermission("SHORTCUT");"authorized"==a?(clearInterval(c),I(Da+"已创建快捷方式到桌面","icon","","",""),f({fp:a}),g(15),ka=!0,Ta=!0,_a.popover.style.display="none"):"denied"==a&&(clearInterval(c),f({fp:a,sr:0}),g(16),_a.postMessage({action:"close_popover",selector:".xiaomi"}),(new Date).getTime()-b<2500&&g(18),x())},200)}else"denied"==a&&(g(12),w())}function n(){console.log("_create_shortcut_for_huawei_meizu start..."),plus.navigator.createShortcut({force:!1,toast:""}),g(2);var a=(new Date).getTime();Ga=plus.navigator.checkPermission("SHORTCUT");var b=(new Date).getTime()-a;if(console.log("create shortcut delay:"+b+",current permission:"+Ga),b>600)if(g(14),"denied"==Ga)if(b>=19e3&&"Meizu"==Ha||b>=15e3&&"HUAWEI"==Ha){g(17),f({op:2,fp:2});var c="Meizu"==Ha?5e3:500;setTimeout(function(){d()},c)}else g(16),_a.postMessage({action:"close_popover",selector:".hw-mz"}),b<2e3&&g(18),y(),x();else g(15),y(),f({op:2,fp:Ga}),E(),_a.postMessage({action:"close_popover",selector:".hw-mz"});else _a.postMessage({action:"close_popover",selector:".hw-mz"}),"notdeny"==Ga||"unsupported"==Ga?(g("notdeny"==Ga?13:10),f({op:Ga,fp:Ga}),E()):"denied"==Ga&&(f({op:Ga}),g(12),w())}function o(){ma?0==xa.ret?1==xa.permission.create?j(xa.permission.unique):p():u():0==xa.ret?1==xa.permission.create?j(xa.permission.unique):(g(46),oa?p():ka=!0):(f({op:11}),g(45),k())}function p(){g(46),g(85),J(Y),Ca="install_stream_manager",Xa=Ua,_a.alert(Za,!0)}function q(){g(84),f({sg:1,gm:Ma}),J(Z),Ca="install_stream_engine",Xa=Va,_a.alert(Ya,!0)}function r(){g(85),f({sg:1,gm:Na}),J(Y),Ca="install_stream_manager",Xa=Ua,_a.alert(Za,!0)}function s(){Fa<5?(g(11),f({op:4,fp:4}),k()):(g(2),plus.navigator.createShortcut({force:!1,toast:""}),setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(a){a.result==Pa?v():(console.log("create shortcut result unknown,begin show guide"),ma?r():na&&"switchLightApp"==plus.runtime.appid)})},800))}function t(){g(2),plus.navigator.createShortcut({force:!1,toast:""}),setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(a){console.log("has shortcut result："+a.result),a.result==Pa?v():(f({sc:a.result,sg:1}),ma?(f({gm:Na}),J(Y),Ca="install_stream_manager",_a.bottom_tips.show()):(f({gm:La}),plus.storage.getItem("qk_status")||(_a.bottom_tips.init({text:Da+"可能未安装到桌面，点此修复"}),_a.bottom_tips.show(),Ca="qiku_repair")))})},500)}function u(a){g(45),plus.navigator.createShortcut({force:!1,toast:""}),g(2),f({op:11}),setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(b){b.result==Pa?(a=a?a:'"'+Da+'"已安装到桌面',I(a,"icon","","",""),f({sg:0,sr:1,sc:b.result}),g(3),ka=!0):r()})},600)}function v(){ka=!0,f({sr:1,sc:e.result}),g(3),plus.storage.setItem("__HAS_SHORTCUT_"+qa,"TRUE")}function w(){var a=0;if(ma)if(plus.networkinfo.getCurrentType()==plus.networkinfo.CONNECTION_CELL2G)J(Y),Ca="guide_permission_set",a=La,_a.bottom_tips.show(),_a.postMessage({action:"permission_set"}),g(83);else{var b=Math.random();Oa="HUAWEI"==Ha?b<.3?La:Na:b<.25?La:b>.5?Ma:Na,a=Oa,console.log("random:"+b+",guide_strategy:"+a),Oa==Ma?q():(J(Y),Oa==Na?(Ca="install_stream_manager",g(85),_a.bottom_tips.show()):(Ca="guide_permission_set",_a.bottom_tips.init(),f({sg:1}),_a.postMessage({action:"permission_set"}),g(83)))}else a=La,Ca="guide_permission_set",_a.bottom_tips.show(),g(83);f({gm:a})}function x(){var a=La;ma?(J(Y),plus.networkinfo.getCurrentType()==plus.networkinfo.CONNECTION_CELL2G?(Ca="guide_permission_set",_a.postMessage({action:"permission_set"}),g(83),_a.bottom_tips.init()):(Aa=!0,I('您拒绝了快捷方式权限，需要安装[流应用]管理器(仅1M)，才可以正常使用"'+Da+'"',"","long","",""),Ca="install_stream_manager",a=Na,g(85),_a.bottom_tips.show())):(Ca="guide_permission_set",g(83),_a.bottom_tips.show()),f({sg:1,gm:a})}function y(){var a=G();plus.io.requestFileSystem(plus.io.PUBLIC_DOCUMENTS,function(b){b.root.getDirectory(a,{create:!0,exclusive:!1},function(a){console.log("setDir Directory Entry Name: "+a.name)},function(a){console.log(a.message)})})}function z(a){plus.io.requestFileSystem(plus.io.PUBLIC_DOCUMENTS,function(b){b.root.getDirectory(a,{},function(a){l()},function(a){console.log("huawei || meizu:first show"),_a.postMessage({action:"show_popover",selector:".hw-mz"}),setTimeout(function(){l()},500)})})}function A(){var a=plus.android.runtimeMainActivity(),b=plus.android.importClass("android.content.Intent"),c=new b("android.intent.action.MAIN");c.addCategory("android.intent.category.HOME"),plus.android.importClass("android.content.pm.PackageManager"),plus.android.importClass("android.content.pm.ResolveInfo");var d,e=a.getPackageManager(),f=e.resolveActivity(c,0);if(null==f)return"-3";var g=f.plusGetAttribute("activityInfo");return null!=g?(d=g.plusGetAttribute("packageName"),null!=d?d:"-2"):void 0}function B(a){ka=!0,_a.beforequit&&_a.beforequit(),setTimeout(function(){H(plus.runtime.appid,a),setTimeout(function(){plus.runtime.quit()},300)},900)}function C(){if(_c=plus.storage.getItem("__FROM_SHORTCUT_"+qa),_c&&parseInt(_c)>2){var a=plus.storage.getItem("__FIRST_TIME_"+qa);((new Date).getTime()-parseInt(a))/1e3/3600/24>2&&setTimeout(function(){g(82),f({gm:Ma}),J(Z),Xa=Va,Ca="install_stream_engine",_a.alert(Ya,!1)},1500)}}function D(){setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(a){console.log("has shortcut result："+a.result),a.result==Pa?v():f({sc:a.result})})},2e3)}function E(){ka=!0,I('"'+Da+'"已安装到桌面',"icon","","",""),_a.bottom_tips.hide(),_a.popover.style.display="none",Ta=!0}function F(a){"trycreate"==a&&plus.nativeUI.toast(Da+"已尝试创建桌面图标，如果没有请再检查权限设置"),plus.navigator.createShortcut({force:!1,toast:""}),g(2),plus.storage.setItem("vivo_success","success"),ka=!0,_a.popover.style.display="none",_a.bottom_tips.hide(),f({sg:"1",cs:"1",gm:"1",gr:"2",sr:"2"})}function G(){var a="";return ma?a="phonefirstopenshow_qihoo":na?a="phonefirstopenshow_stream":oa&&(a="phonefirstopenshow_streamengine"),a}function H(a,b){console.log("begin to launch stream engine");var c=plus.android.runtimeMainActivity(),d=plus.android.importClass("android.content.Intent"),e=new d(d.ACTION_MAIN);if(e.setClassName(Z,"io.dcloud.appstream.StreamAppMainActivity"),b)e.putExtra("appid",a);else if(ra==sa){var f=plus.storage.getItem("__FROM_SHORTCUT_"+qa);f&&Math.random()<.5?(e.putExtra("short_cut_appid",a),e.putExtra("from_short_cut_start",!0)):e.putExtra("appid",a)}else e.putExtra("appid",a);c.startActivity(e)}function I(a,b,c,d,e){plus.nativeUI.toast(a,{icon:""==b?"":ua,duration:""==c?"short":c,verticalAlign:""==d?"bottom":d}),"again"==e&&(ya=setTimeout(function(){plus.nativeUI.toast(a,{duration:c,verticalAlign:d})},3700))}function J(a){var b=a==Z?"h5frameworks":"streams",c=a==Z?ba:aa;shortcut_util.getJSON(ca+"//stream.dcloud.net.cn/check/update?appid="+a+"&version=0.1&type=native",{},function(d){if(d){var e=d.version;plus.io.resolveLocalFileSystemURL("_downloads/"+b,function(d){plus.io.resolveLocalFileSystemURL("_downloads/"+b+"/"+e+".apk",function(c){console.log("apk is already stored in disk"),Ba="_downloads/"+b+"/"+e+".apk",f({bd:1,dc:1}),Aa&&L(a)},function(f){console.log("file Resolve file URL failed: "+f.message),d.removeRecursively(),K(c,a,b,e)})},function(d){K(c,a,b,e)})}})}function K(a,b,c,d){var e=plus.downloader.createDownload(a,{filename:"_downloads/"+c+"/"+d+".apk"},function(a,c){plus.nativeUI.closeWaiting(),200==c?(f({dc:1}),Ba=a.filename,Aa&&L(b)):console.log("Download failed: "+c)});e.start(),f({bd:1})}function L(a){a!=Y||Aa||I('因本机权限限制，需要安装[流应用]管理器(仅1M)后才可以使用"'+Da+'"流应用版',"","long","","again"),Qa=Ra,plus.runtime.install(Ba,{},function(){M(a)},function(){console.log("install error")})}function M(b){var c=(new Date).getTime();za=setInterval(function(){(new Date).getTime()-c>12e4&&clearInterval(za),a(b)&&(clearInterval(za),f({ic:1,l:"1",gr:1}),ka=!0,wa&&(wa=!1),b==Y?(g(92),_a.beforequit&&_a.beforequit(),setTimeout(function(){plus.runtime.launchApplication({pname:b,extra:{appid:plus.runtime.appid}}),setTimeout(function(){plus.runtime.quit()},300)},800)):(g(91),B(!0)))},200)}function N(a,b){Qa=Sa,f({cs:1}),I(a,"","long",b,"again")}function O(){function a(a){shortcut_util.getJSON(ia,{imei:a,p:"Android"==plus.os.name?"a":"i",md:plus.device.model,vb:plus.runtime.version},function(a){a&&0==parseInt(a.ret)&&a.uuid&&(Ja=a.uuid,plus.storage.setItem("__DEVICE_ID",a.uuid),console.log("device reg response:"+a.uuid))})}ra=plus.runtime.launcher,Ea=A(),plus.storage.setItem("__LAUNCHER_PKG_NAME",Ea),Fa=plus.os.version?parseFloat(plus.os.version):Fa,Ha=plus.device.vendor,Ia=plus.device.model;var b=plus.device.imei.split(","),c=[];shortcut_util.each(b,function(a,b){["020000000000","null"].indexOf(b)>-1||c.push(b)}),Ja=c.join();var d=plus.storage.getItem("__LAST_IMEI"),e=plus.storage.getItem("__DEVICE_ID"),f=plus.storage.getItem("__LAST_RANDOM");if(Ja){var g="|"+Ja+"||||";d&&Ja===d?e?Ja=e:a(g):(plus.storage.setItem("__LAST_IMEI",Ja),f&&(g="|"+Ja+"|||"+f+"|"),a(g))}else if(e)Ja=e;else{if(f)Ja=f;else{var h=new Date;Ja=plus.device.model+h.getFullYear()+(h.getMonth()+1)+h.getDate()+h.getHours()+parseInt(1e5*Math.random()),plus.storage.setItem("__LAST_RANDOM",Ja)}a("||||"+Ja+"|")}Ka=plus.display.height,plus.runtime.getProperty(plus.runtime.appid,function(a){Da=a.name})}function P(){document.addEventListener("pause",function(){if(Ta&&setTimeout(function(){Ta=!1,D(),f(54)},800),!ka)return la?(g(51),clearTimeout(la),la=null,g(53),void k()):void((ma||oa)&&Qa!==Ra&&Qa!==Sa&&(g(51),wa&&(plus.navigator.createShortcut({force:!1,toast:""}),g(2),f({sr:2}),g(52),setTimeout(function(){D()},500)),ta>=25462&&ra!==sa&&"myapp"!=ra&&("HUAWEI"==Ha&&Fa>=6?I('"'+Da+'"流应用版还未安装到桌面，再次启动需点击360手机助手',"","","",""):plus.navigator.hasShortcut({name:Da},function(a){a.result==Pa?ka=!0:I('"'+Da+'"流应用版还未安装到桌面，再次启动需点击360手机助手',"","","","")}))))},!1),document.addEventListener("resume",function(){ka||(g(61),clearInterval(za),clearTimeout(ya),Aa&&(_a.bottom_tips.show(),Aa=!1),"vivo"==Ha&&(Qa==Ra?_a.bottom_tips.hide():Qa==Sa&&F("trycreate")),Qa==Ra&&(Qa=NEXT_PAUSE_DEFAULT))},!1)}function Q(){try{var a=plus.android.importClass("android.content.Intent"),b=plus.android.runtimeMainActivity(),c=new a("com.meizu.safe.security.SHOW_APPSEC");c.addCategory("android.intent.category.DEFAULT"),c.putExtra("packageName",window.__pkg_name),c.putExtra("needQuery",!0),b.startActivity(c)}catch(a){console.log("Error: "+JSON.stringify(a))}}function R(){var a=plus.navigator.checkPermission("SHORTCUT");if("unknown"!==a)try{var b=plus.android.importClass("android.content.Intent"),c=plus.android.runtimeMainActivity(),d=new b("miui.intent.action.APP_PERM_EDITOR");d.putExtra("extra_pkgname",window.__pkg_name),c.startActivity(d)}catch(a){}}function S(){var a=plus.navigator.checkPermission("SHORTCUT");if("unknown"!==a&&"unsupported"!==a)try{var b=plus.android.importClass("android.content.Intent"),c=plus.android.runtimeMainActivity(),d=new b("huawei.intent.action.HSM_PERMISSION_MANAGER");c.startActivity(d)}catch(a){}}function T(a){try{var b=plus.android.importClass("android.content.Intent"),c=plus.android.runtimeMainActivity(),d=new b(a);c.startActivity(d)}catch(a){}}function U(a){var b=plus.android.runtimeMainActivity(),c=b.getPackageManager();plus.android.importClass(c);var d=c.getPackageInfo(a,0);return plus.android.importClass(d),plus.android.getAttribute(d,"versionName")}function V(a,b){for(var c=a.split("."),d=b.split("."),e=0;e<c.length;e++){if(parseInt(c[e])<parseInt(d[e]))return!0;if(parseInt(c[e])>parseInt(d[e]))return!1}return!1}var W=navigator.userAgent,X="com.qihoo.appstore",Y="io.dcloud.streamapps",Z="io.dcloud.html5pframework",$=X,_="http://stream.cdn.aliyun.dcloud.net.cn/r/apps/native",aa=_+"/PS/"+Y+"/latest/"+Y+".apk",ba=_+"/RK/"+Z+"/latest/"+Z+".apk",ca="file:"==location.protocol?"https:":location.protocol,da=ca+"//stream.dcloud.net.cn/launcher/thirdpart",ea=ca+"//stream.dcloud.net.cn/shortcut/permission",fa=ca+"//stream.dcloud.net.cn/collect/shortcut/result",ga=ca+"//stream.dcloud.net.cn/shortcut/user",ha=ca+"//stream.dcloud.net.cn/shortcut/startup",ia=ca+"//stream.dcloud.net.cn/device/reg",ja="http://stream.cdn.aliyun.dcloud.net.cn/shortcut/__shortcut.html?v=0.0.9",ka=!1,la=null,ma=!1,na=!1,oa=!1,pa="360手机助手",qa="SZ_PLUGIN",ra="default",sa="shortcut",ta=0,ua="_www/img/logo.png",va="http://img.cdn.aliyun.dcloud.net.cn/shortcut/stream.png",wa=!1,xa={},ya=null,za=null,Aa=!1,Ba="",Ca="",Da="",Ea="",Fa=.1,Ga="unknown",Ha="",Ia="",Ja="",Ka=0,La=1,Ma=2,Na=3,Oa=Ma,Pa="existing",Qa=NEXT_PAUSE_DEFAULT=0,Ra=1,Sa=2,Ta=!1,Ua="因手机兼容问题，需要安装[流应用]管理器(仅1M)才能正常使用",Va="依赖的底层引擎已经重大升级，需要安装更新。\n更新内容\n1. 大幅提升启动速度\n2. 解决某些手机上任务进程无法显示的bug\n3. 解决从桌面点击偶尔重启等若干bug",Wa="小米手机需要安装更高版本的流应用引擎才能继续使用",Xa="",Ya="install_stream_engine",Za="install_stream_manager",$a={},_a={beforequit:null,isBadQihooVersion:function(){var a=U(X);return V(a,"5.1.96")},alert:function(a,b){plus.nativeUI.alert(Xa,function(c){if(c.index==-1)b&&_a.bottom_tips.show(),g(28);else{var d=Y,e=27;a!==Za&&(d=Z,e=26),g(e),Aa=!0,_a.quickInstallPackage(d)}},"升级提示","立即安装（仅1M）")},bottom_tips:{elem:null,options:{bgColor:"#f00",bottom:0,text:""},init:function(a){if(a&&shortcut_util.extend(this.options,a),this.elem)this.elem.style.bottom=this.options.bottom,this.elem.style.backgroundColor=this.options.bgColor,this.options.text&&(this.elem.innerHTML=this.options.text);else{var b="font-size: 14px;text-align: center;height: 35px;color: #fff;font-weight: 300;line-height: 35px;opacity: 0.8;position:fixed;z-index: 99999;right: 0;left: 0;display:none;",c=document.createElement("footer");c.setAttribute("style",b),c.setAttribute("id","__shortcut_bottom_tips"),c.style.bottom=this.options.bottom,this.options.bgColor=na?"#007AFF":this.options.bgColor,c.style.backgroundColor=this.options.bgColor;var d=document.createElement("div"),e="install_stream_engine"==Ca?"引擎未更新，下次无法使用，点此修复":"应用无法安装到桌面，点此修复";d.innerHTML=this.options.text?this.options.text:e,c.appendChild(d),document.body.appendChild(c),this.elem=c,this.elem.addEventListener("click",function(){"guide_permission_set"==Ca?(g(24),_a.postMessage({action:"permission_set"}),_a.bottom_tips.hide()):"install_stream_engine"==Ca?(g(21),_a.alert(Ya,!0)):"install_stream_manager"==Ca?(g(22),_a.quickInstallPackage(Y)):"2gvivoshow"==Ca?(f({gm:Oa,sg:1}),_a.popover.style.display="block",_a.bottom_tips.hide()):"guide_change_launcher"==Ca?(f({gm:Oa,sg:1}),_a.postMessage({action:"guide_change_launcher",name:plus.storage.getItem("__LAUNCHER_NAME")}),_a.bottom_tips.hide()):"qiku_repair"==Ca&&(g(23),_a.postMessage({action:"show_popover",selector:".qiku"}),_a.bottom_tips.hide()),f({cs:1})})}},show:function(){this.elem||this.init(),this.elem.style.display="block"},hide:function(){this.elem||this.init(),this.elem.style.display="none"}},pause:{PAUSE_TYPE_SET:Sa,setPauseType:function(a){Qa=a},ignore:function(){return Qa==Ra||Qa==Sa}},postMessage:function(a){"close_popover"==a.action?this.popover.style.display="none":"init"!==a.action&&(this.popover.style.display="block"),a=shortcut_util.extend(a,{origin:location.href}),this.ifm.contentWindow.postMessage(JSON.stringify(a),ja)},get_logo_url:function(){shortcut_util.getJSON("http://stream.dcloud.net.cn/apps/detail",{appid:plus.runtime.appid},function(a){a&&0==parseInt(a.ret)&&a.name&&"HBuilder"!==plus.runtime.appid&&(va="http://stream.dcloud.net.cn/resource/icon?width=480&appid="+plus.runtime.appid)})},init:function(e){return W.indexOf("qihoobrowser")>-1?void(ka=!0):(e=shortcut_util.extend({},e),e.logo&&(ua="_www/"+e.logo),window.addEventListener("message",function(a){var b=a.data;if(console.log("receive message from iframe:"+b),b&&(b=JSON.parse(b)),b&&b.action)switch(b.action){case"set_shortcut_permission":_a.set_shortcut_permission();break;case"click_stream_manager_link":_a.click_stream_manager_link();break;case"recreate_shortcut":_a.recreate_shortcut();break;case"change_launcher":_a.change_launcher()}},!1),e.beforequit&&(this.beforequit=e.beforequit),void shortcut_util.plusReady(function(){if("Android"!==plus.os.name)return void(ka=!0);O();var h=plus.runtime.innerVersion;if("HBuilder"==plus.runtime.appid)return void(ka=!0);var i=h.substring(h.lastIndexOf(".")+1,h.length);if(i&&(ta=parseInt(i)),ta<25462)return void console.log("old version,skip...");$a={appid:plus.runtime.appid,imei:Ja,p:"Android"==plus.os.name?"a":"i",ov:plus.os.version,sf:ra,md:Ia,net:plus.networkinfo.getCurrentType(),vb:h,vd:Ha,lpn:Ea,av:plus.runtime.version};var j=!1;ra==sa&&(j=!0,ka=!0);var l=null,m=(new Date).getTime();if(ma=/^1.0.0/.test(h)){if(a(Z)){ka=!0;var n=!0;return l=plus.storage.getItem("__LAUNCH_ENGINE_"+qa),!l&&m-parseInt(l)<36e5?n=!1:plus.storage.setItem("__LAUNCH_ENGINE_"+qa,m+""),ra==sa?plus.nativeUI.confirm('本机已安装更新版本的"'+Da+'"\n请删除此图标，点击新版图标。\n如果桌面上没有第二个新图标，请点下方“启动新版”后，在关于界面里修复桌面图标',function(a){a.index>0?(B(n),g(104)):g(103)},"",["回到旧版","启动新版"]):(B(n),g(104)),void g(102)}if("Xiaomi"==Ha&&_a.isBadQihooVersion())return J(Z),Ca="install_stream_engine",setTimeout(function(){Xa=Wa,_a.alert(Ya,!0),f({op:-3,gm:Ma}),g(81),ra!=sa&&"myapp"!=ra&&(plus.navigator.createShortcut({toast:"",force:!1}),g(2))},600),void b();ra==sa&&"HUAWEI"!==Ha&&C()}else if(na=/1.5.0/.test(h)){if("myapp"==ra)return void(ka=!0);pa="流应用",qa="STREAM_MANAGER",$=Y}else if(oa=/1.7.0/.test(h))pa="Html5+Framework",qa="STREAM_ENGINE",$=Z;else if(/1.1.0/.test(h))return;var o=shortcut_util.extend({},e.bottom_tips);_a.bottom_tips.init(o),window.__pkg_name=$;var p=plus.storage.getItem("__FIRST_TIME_"+qa);p||plus.storage.setItem("__FIRST_TIME_"+qa,m+"");var q=plus.storage.getItem("__HAS_SHORTCUT_"+qa);if(ra==sa){if(ka=!0,document.body.removeChild(_a.ifm),q){var r=plus.storage.getItem("__FROM_SHORTCUT_"+qa);r?plus.storage.setItem("__FROM_SHORTCUT_"+qa,parseInt(r)+1+""):plus.storage.setItem("__FROM_SHORTCUT_"+qa,"1")}else plus.storage.setItem("__HAS_SHORTCUT_"+qa,"TRUE"),plus.storage.setItem("__FROM_SHORTCUT_"+qa,"1");var s={appid:plus.runtime.appid,imei:Ja,vendor:Ha,launcher:Ea,model:Ia,os:plus.os.version,vb:plus.runtime.innerVersion},t=plus.storage.getItem("__REPORT_SHORTCUT_"+qa);return void((!t||m-parseInt(t)>6048e5)&&("HUAWEI"==Ha&&Fa>=6?shortcut_util.getJSON(ha,s,function(a){a&&plus.storage.setItem("__REPORT_SHORTCUT_"+qa,m+"")}):setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(a){shortcut_util.getJSON(ha,shortcut_util.extend(s,{result:a.result}),function(a){a&&plus.storage.setItem("__REPORT_SHORTCUT_"+qa,m+"")})})},500)))}"HUAWEI"==Ha&&Fa>=6||setTimeout(function(){plus.navigator.hasShortcut({name:Da},function(a){a.result==Pa&&(j=!0,ka=!0,g(4),q||plus.storage.setItem("__HAS_SHORTCUT_"+qa,"TRUE"))})},300),g(1),setTimeout(function(){if(!j&&(c(shortcut_util.extend({},e.iframe,{appid:plus.runtime.appid,vendor:Ha,appname:Da,innerversion:h,runtime_name:pa,runtime_id:qa,logo_path:va})),_a.ifm=document.getElementById("__shortcut_ifm"),_a.popover=document.getElementById("__shortcut_guide_popover"),!_a.ifm))return la&&clearTimeout(la),void k()},600),la=setTimeout(function(){la=null,j||d()},1500),b(),P()}))}};if(_a.scan_permission=function(){_a.pause.setPauseType(_a.pause.PAUSE_TYPE_SET);var a=(new Date).getTime();za=setInterval(function(){(new Date).getTime()-a>12e4&&clearInterval(za),Ga=plus.navigator.checkPermission("SHORTCUT"),"Xiaomi"==Ha&&"authorized"==Ga?(clearInterval(za),g(19),g(2),plus.navigator.createShortcut({force:!1,toast:""}),I('"'+Da+'"已安装到桌面',"icon","","",""),ka=!0,_a.popover.style.display="none",_a.bottom_tips.hide()):"Meizu"!=Ha&&"HUAWEI"!=Ha||"notdeny"!=Ga||(clearInterval(za),g(19),g(2),plus.navigator.createShortcut({force:!1,toast:""}),E())},300)},_a.scan_launcher=function(){Qa=Sa;var a="",b=(new Date).getTime();za=setInterval(function(){(new Date).getTime()-b>18e4&&clearInterval(za),a=A(),a!=Ea&&(clearInterval(za),Ea=a,g(63),d(),_a.popover.style.display="none")},500)},_a.scan_launcher_smartisan=function(){var a="",b=(new Date).getTime(),c=setInterval(function(){(new Date).getTime()-b>3e5&&clearInterval(c),a=A(),"com.android.launcher3"==a&&(clearInterval(c),g(36),g(2),plus.navigator.createShortcut({force:!1,toast:""},function(a){I("应用已安装到桌面。如没有请尝试重启手机。请勿删除桌面图标，否则应用无法启动","icon","","",""),ka=!0,_a.popover.style.display="none",_a.bottom_tips.hide()}))},500)},_a.maybe_success_qiku=function(a){a&&I("已创建桌面图标，如没有请检查 设置->桌面设置->快捷方式启用","icon","","",""),_a.popover.style.display="none",_a.bottom_tips.hide(),plus.storage.setItem("qk_status","qk_success"),
f({gr:2,sr:1}),ka=!0},_a.beforeback=function(){return!!ka||(_a.ifm&&"block"==_a.popover.style.display?(_a.popover.style.display="none",_a.bottom_tips.show(),g(29),!1):la?(clearTimeout(la),la=null,k(),g(73),!0):ma||oa?(plus.nativeUI.confirm("您还没安装"+Da+"到手机桌面，退出后会导致以后无法从桌面启动。确认以后不再使用"+Da+"了吗？",function(a){0==a.index?(g(72),f({gr:0,sr:0}),wa&&(plus.navigator.createShortcut({force:!1,toast:""}),g(2)),_a.beforequit&&_a.beforequit(),setTimeout(function(){plus.runtime.quit()},600)):1==a.index&&(g(71),"install_stream_engine"==Ca||"xiaomi_badversion_install"==Ca?_a.quickInstallPackage(Z):_a.bottom_tips.elem.dispatchEvent(new CustomEvent("click",{detail:{},bubbles:!0,cancelable:!0})))},"提醒",["确认不用了","要用，继续安装"]),!1):void 0)},window.wap2app){var ab=wap2app.back;wap2app.back=function(){_a.beforeback()!==!1&&ab()}}_a.quickInstallPackage=function(a){plus.nativeUI.showWaiting();var b=setInterval(function(){""!==Ba&&(clearInterval(b),plus.nativeUI.closeWaiting(),L(a))},200)},_a.set_shortcut_permission=function(){if(g(31),~["QiKU","360"].indexOf(Ha))N("请点击打开“快捷方式启用”开关","center"),T("com.yulong.android.launcher3.settings");else if("vivo"==Ha){var a="请选择“"+pa+"”- 点“允许”";N("请选择“"+pa+"”- 点“允许”","center"),T("com.bbk.launcher.installshortcutpermission.open")}else{if("Meizu"==Ha)N("请选择“桌面快捷方式”-点“允许”","top"),Q();else if("HUAWEI"==Ha){var a="请选择“"+pa+"”，打开窗口后滚动到底部，选择“创建桌面快捷方式”-点“允许”";N(a,"center"),S()}else"Xiaomi"==Ha&&(N("请滚动到底部选择“桌面快捷方式”-点“允许”","center"),R());_a.scan_permission()}},_a.click_stream_manager_link=function(){g(33),this.quickInstallPackage(Y)},_a.recreate_shortcut=function(){if(g(32),"QiKU"==Ha||"360"==Ha)plus.navigator.createShortcut({force:!1,toast:""},function(a){_a.maybe_success_qiku(!0)});else if("smartisan"==Ha){if(Ea=A(),"com.android.launcher3"!=Ea)return void plus.nativeUI.alert('请点"前往设置"按钮配置正确桌面视图');g(2),plus.navigator.createShortcut({force:!1,toast:""},function(a){I("应用已安装到桌面。如没有请尝试重启手机。请勿删除桌面图标，否则应用无法启动","icon","","",""),ka=!0,_a.popover.style.display="none",_a.bottom_tips.hide()})}},_a.change_launcher=function(){Qa=Sa,g(35),T("android.settings.SETTINGS"),"smartisan"==Ha?(N("请选择“桌面设置项”，打开窗口后选择“安卓原生”-点“确认”","bottom"),this.scan_launcher_smartisan()):this.scan_launcher()},window.__shortcut=_a,window.wap2app&&shortcut_util.plusReady(function(){"boolean"==typeof wap2app.shortcutConfig&&wap2app.shortcutConfig===!1||_a.init(wap2app.shortcutConfig)})}();